{% extends "base.html" %}
{% block content %}
<h2>Students</h2>
<a href="{{ url_for('add_student') }}" class="btn btn-primary mb-3">Add Student</a>

<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Admission No</th>
            <th>Name</th>
            <th>DOB</th>
            <th>Gender</th>
            <th>Phone</th>
            <th>Address</th>
            <th>Class</th>
            <th>Section</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for s in students %}
        <tr>
            <td>{{ s.student_id }}</td>
            <td>{{ s.admission_no or '' }}</td>
            <td>{{ s.student_name }}</td>
            <td>{{ s.dob }}</td>
            <td>{{ s.gender }}</td>
            <td>{{ s.phone or '' }}</td>
            <td>{{ s.address or '' }}</td>
            <td>{{ s.class_name or '' }}</td>
            <td>{{ s.section_name or '' }}</td>
            <td>
                <a href="{{ url_for('edit_student', sid=s.student_id) }}" class="btn btn-sm btn-warning mb-1">Edit</a>
                <form action="{{ url_for('delete_student', sid=s.student_id) }}" method="POST" style="display:inline-block;">
                    <button class="btn btn-sm btn-danger mb-1" onclick="return confirm('Delete this student?')">Delete</button>
                </form>
                {% if s.student_id %}
                <button class="btn btn-sm btn-success mb-1" data-bs-toggle="modal" data-bs-target="#enrollModal{{ s.student_id }}">Enroll</button>

                <!-- Enrollment Modal -->
                <div class="modal fade" id="enrollModal{{ s.student_id }}" tabindex="-1">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <form action="{{ url_for('enrollment_form') }}" method="POST">
                        <div class="modal-header">
                          <h5 class="modal-title">Enroll {{ s.student_name }}</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                          <input type="hidden" name="student_id" value="{{ s.student_id }}">
                          <div class="mb-3">
                            <label>Class</label>
                            <select name="class_id" class="form-select" required>
                              {% for c in classes %}
                              <option value="{{ c.class_id }}">{{ c.class_name }}</option>
                              {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <label>Section</label>
                            <select name="section_id" class="form-select" required>
                              {% for sec in sections %}
                              <option value="{{ sec.section_id }}">{{ sec.section_name }}</option>
                              {% endfor %}
                            </select>
                          </div>
                          <div class="mb-3">
                            <label>Admission Date</label>
                            <input type="date" name="admission_date" class="form-control">
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                          <button class="btn btn-primary">Enroll</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>

                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
